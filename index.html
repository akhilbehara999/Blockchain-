<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlockSim - Interactive Blockchain Simulator</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>BlockSim: Blockchain Simulator</h1>
            <p>Learn how blockchains work by building one. Create transactions, mine blocks, and see what happens when you try to cheat.</p>
            <div style="margin-top: 15px;">
                <button id="start-guide-btn" style="width: auto; background: var(--success); padding: 8px 16px;">üéì Start Interactive Guide</button>
            </div>
        </header>

        <!-- Settings Section -->
        <section class="card" id="settings-section">
            <h2>Simulation Settings</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="consensus-type">Consensus Mechanism</label>
                    <select id="consensus-type">
                        <option value="POW">Proof of Work (Mining)</option>
                        <option value="POS">Proof of Stake (Validation)</option>
                    </select>
                    <small>Choose how blocks are added.</small>
                </div>
                <div class="setting-item" id="difficulty-setting">
                    <label for="difficulty">Mining Difficulty (1-5): <span id="difficulty-value">3</span></label>
                    <input type="range" id="difficulty" min="1" max="5" value="3">
                    <small>Higher difficulty = longer mining time (more leading zeros).</small>
                </div>
                <div class="setting-item">
                    <label style="cursor: pointer;">
                        <input type="checkbox" id="tamper-mode"> <strong>Enable Tampering Mode</strong>
                    </label>
                    <small class="warning-text" id="tamper-warning" style="display: none; color: var(--danger);">‚ö†Ô∏è Allows editing past blocks to break the chain.</small>
                </div>
                <div class="setting-item">
                    <label style="cursor: pointer;">
                        <input type="checkbox" id="sandbox-mode"> <strong>Sandbox Mode</strong>
                    </label>
                    <small>Disables strict UI steps (allows creating invalid states for learning).</small>
                </div>
                <div class="setting-item">
                    <button id="reset-app" class="btn-danger btn-sm">Reset Simulator</button>
                </div>
            </div>
        </section>

        <!-- Main Grid: Transactions & Mempool -->
        <div class="grid-2">
            <!-- 1. Transaction Creator -->
            <section class="card" id="transaction-creator">
                <h2>1. Create Transaction</h2>
                <div class="form-group">
                    <label for="sender">Sender</label>
                    <input type="text" id="sender" placeholder="e.g., Alice">
                    <div class="error-msg" id="sender-error"></div>
                </div>
                <div class="form-group">
                    <label for="receiver">Receiver</label>
                    <input type="text" id="receiver" placeholder="e.g., Bob">
                    <div class="error-msg" id="receiver-error"></div>
                </div>
                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input type="number" id="amount" placeholder="e.g., 50" min="1">
                    <div class="error-msg" id="amount-error"></div>
                </div>
                <button id="create-tx-btn" disabled>Add to Mempool</button>
                <small style="display: block; margin-top: 10px; text-align: center;">Transactions start as "pending" in the mempool.</small>
            </section>

            <!-- 2. Mempool -->
            <section class="card" id="mempool-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2 style="margin:0; border:none;">2. Mempool <span id="mempool-count" class="badge">0</span></h2>
                </div>
                <div style="border-bottom: 2px solid var(--border); margin-bottom: 15px;"></div>

                <div id="mempool-list" class="transaction-list">
                    <!-- Transactions appear here -->
                    <p style="text-align: center; color: var(--text-muted); padding: 20px;">No pending transactions.</p>
                </div>
                <button id="create-block-btn" disabled>Create Block from Mempool</button>
            </section>
        </div>

        <!-- 3. Block Builder / Mining -->
        <section id="block-builder" class="card hidden">
            <h2>3. Mine New Block</h2>
            <div class="block-preview">
                <div class="block-header">
                    <span>Index: #<span id="builder-index"></span></span>
                    <span><span id="builder-timestamp"></span></span>
                </div>

                <div style="margin-bottom: 15px;">
                    <label>Previous Hash:</label>
                    <span id="builder-prev-hash" class="hash-display"></span>
                </div>

                <div style="margin-bottom: 15px;">
                    <label>Transactions:</label>
                    <ul id="builder-tx-list" style="padding-left: 20px; font-size: 0.9rem;"></ul>
                </div>

                <div class="settings-grid" style="background: white; padding: 15px; border-radius: 4px; border: 1px solid var(--border);">
                    <div class="setting-item">
                        <label title="A random number changed to find a valid hash">Nonce (Proof of Work) ‚ÑπÔ∏è:</label>
                        <span id="builder-nonce" style="font-family: monospace; font-size: 1.2rem; font-weight: bold;">0</span>
                    </div>
                    <div class="setting-item">
                        <label>Current Hash:</label>
                        <span id="builder-hash" class="hash-display" style="font-size: 0.8rem;"></span>
                    </div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px; flex-direction: column;">
                    <div id="mining-status" style="text-align: center; font-weight: bold; height: 1.5em;"></div>
                    <button id="mine-block-btn">‚õèÔ∏è Mine Block (Find Hash)</button>
                    <button id="add-block-btn" disabled class="btn-success" style="background-color: var(--success);">‚ûï Add Block to Chain</button>
                </div>
            </div>
        </section>

        <!-- 4. Blockchain -->
        <section id="blockchain-section">
            <h2>4. Blockchain</h2>
            <p>Scroll horizontally to view the entire chain. Green blocks are valid. Red blocks are invalid.</p>
            <div id="blockchain-container">
                <!-- Blocks rendered here -->
            </div>
        </section>

        <!-- 5. Attack Lab (Hidden by default) -->
        <section id="attack-lab" class="card hidden" style="border-color: var(--danger);">
            <h2 class="text-danger">5. Attack Lab</h2>
            <p>Simulate common blockchain attacks to see how they break the chain (or fail).</p>
            <div class="grid-2">
                <button onclick="window.app.attackMode.doubleSpend()" class="btn-danger">Attempt Double Spend</button>
                <button onclick="window.app.attackMode.forkChain()" class="btn-danger">Fork Chain (Split)</button>
            </div>
            <div id="attack-info" style="margin-top: 15px; padding: 10px; background: var(--danger-bg); border-radius: var(--radius); display: none;"></div>
        </section>
    </div>

    <script type="module" src="src/app.js"></script>
</body>
</html>
